API_Ecommerce\src\api\v1\models\users.model.tsimportmongoose,{Schema}from'mongoose'import{IUser}from'~/api/v1/types/user.type'import{UserMessage}from'~/api/v1/constants/messages.constant'import{ISocialAccounts}from'~/api/v1/types/user.type'import{addressSchema}from'~/api/v1/models/address.model'import{GenderObject,StatusUser}from'~/api/v1/constants/common.constant'constsocialAccountsSchema=newSchema<ISocialAccounts>({facebookId:{type:String},googleId:{type:String}})exportconstuserSchema=newSchema<IUser>({email:{type:String,required:[true,UserMessage.EMAIL_IS_REQUIRED],unique:true,lowercase:true,trim:true,match:[/^\w+([.-]?\w+)_@\w+([.-]?\w+)_(\.\w{2,3})+$/,UserMessage.EMAIL_IS_INVALID]},password:{type:String,required:[true,UserMessage.PASSWORD_IS_REQUIRED],minlength:[6,UserMessage.PASSWORD_LENGTH_MUST_BE_FROM_6_TO_50]},firstName:{type:String,required:[true,UserMessage.FIRST_NAME_IS_REQUIRED],trim:true,maxlength:[50,UserMessage.FIRST_NAME_LENGTH_MUST_BE_FROM_6_TO_50]},lastName:{type:String,required:[true,UserMessage.LAST_NAME_IS_REQUIRED],trim:true,maxlength:[50,UserMessage.LAST_NAME_LENGTH_MUST_BE_FROM_6_TO_50]},phoneNumber:{type:String,trim:true,match:[/^[0-9+\-\s()]+$/,UserMessage.PHONE_NUMBER_INVALID]},dateOfBirth:{type:Date,validate:{validator:function(date:Date){returndate<newDate()},message:UserMessage.DATE_OF_BIRTH_INVALID}},gender:{type:String,enum:{values:[GenderObject.male,GenderObject.female,GenderObject.other]},default:GenderObject.other},avatar:{type:String,default:null},//AccountStatusisEmailVerified:{type:Boolean,default:false},isPhoneVerified:{type:Boolean,default:false},status:{type:String,enum:{values:[StatusUser.active,StatusUser.inactive,StatusUser.suspended,StatusUser.deleted],message:'Trạngtháikhônghợplệ'},default:StatusUser.active},role:{type:String,enum:{values:['customer','admin','seller'],message:'Vaitròkhônghợplệ'},default:'customer'},//StatisticstotalOrders:{type:Number,default:0,min:[0,'Tổngđơnhàngkhôngđượcâm']},totalSpent:{type:Number,default:0,min:[0,'Tổngchitiêukhôngđượcâm']},address:[addressSchema],wishList:[{type:mongoose.Types.ObjectId,ref:'Product'}],//SecurityFieldsemailVerificationToken:String,emailVerificationExpires:Date,passwordResetOTP:String,//LưuOTPđãhashpasswordResetOTPExpires:Date,//ThờigianhếthạncủaOTPpasswordResetToken:String,//Backup:EmailresetthayvìOTPpasswordResetAttempts:Number,//SốlầnnhậpsaiOTPpasswordResetLastAttempts:Date,//ThờigianmớinhấtnhậpOTPpasswordChangeAt:Date,//PasswordthayđổingàynàoisOTPVerified:{type:Boolean},accountLockUntils:Date,//TạmkhóatàikhoảntrongkhoảngthờigianloginAttempts:Number,//Đếmsốlầnloginsai//SocialAccountssocialAccounts:{type:socialAccountsSchema,default:()=>({})}})```````API_Ecommerce\src\api\v1\models\tokensBlackList.model.tsimport{Schema}from'mongoose'import{IBlackListsType}from'~/api/v1/types/tokensBlackList.type'exportconsttokenBlackListsSchema=newSchema<IBlackListsType>({token:{type:String,required:true,unique:true,index:true},userId:{type:String,required:true,index:true},blacklistedAt:{type:Date,default:Date.now},expiresAt:{type:Date,required:true,index:{expireAfterSeconds:0}}})```````API_Ecommerce\src\api\v1\models\shop.model.tsimport{Schema}from'mongoose'import{IShop}from'~/api/v1/types/shop.type'exportconstshopSchema=newSchema<IShop>({user_id:{type:Schema.Types.ObjectId,ref:'User',required:true,unique:true},shop_name:{type:String,required:true,unique:true,trim:true,maxlength:100},shop_phone:{type:String,required:true},shop_email:{type:String,required:true},shop_slug:{type:String,required:true,unique:true,lowercase:true},shop_description:{type:String,maxlength:500},shop_logo:{type:String,default:null},shop_banner:{type:String,default:null},business_type:{type:String,enum:['individual','company'],default:'individual'},owner_info:{full_name:{type:String,required:true,trim:true},avatar:{type:String//URLtouploadedavatar}},tax_id:{type:String,sparse:true},address:{street:String,city:String,state:String,country:String,postal_code:String},shop_ratings:{type:Number,default:0,min:0,max:5},total_products:{type:Number,default:0},total_sales:{type:Number,default:0},is_verify_email:{type:Boolean,default:false},is_verify_phone:{type:Boolean,default:false},is_verified:{type:Boolean,default:false},verified_at:{type:Date,default:null},status:{type:String,enum:['active','inactive','suspended'],default:'active'}},{timestamps:true})``````API_Ecommerce\src\api\v1\models\refreshtoken.model.tsimport{Schema}from'mongoose'import{IRefreshToken}from'~/api/v1/types/auth.type'exportconstrefreshTokenModelSchema=newSchema<IRefreshToken>({userId:{type:Schema.Types.ObjectId,ref:'User',required:true,index:true},token:{type:String,required:true,unique:true,index:true},exp:{type:Date,required:true,index:{expireAfterSeconds:0}},iat:{type:Date,required:true},isActive:{type:Boolean,default:true,index:true},deviceInfo:{userAgent:String,ip:String}},{timestamps:true})``````API_Ecommerce\src\api\v1\models\product.model.tsimport{Schema}from'mongoose'import{IClothing,IElectronics,IFurniture,IProduct}from'~/api/v1/types/product.type'exportconstproductSchema=newSchema<IProduct>({product_name:{type:String,required:[true,'Productnameisrequired'],trim:true,maxlength:[200,'Productnamecannotexeed200characters'],index:'text'},product_thumb:{type:String,required:[true,'Productthumbnailisrequired'],validate:{validator:(v:string)=>{return/^https?:\/\/.+\.(jpg|jpeg|png)$/i.test(v)},message:'ProductthumbnailmustbeavalidimageURL'}},product_description:{type:String,required:[true,'Productdescriptionisrequired'],maxlength:[2000,'Descriptioncannotexceed2000characters'],index:'text'},product_price:{type:Number,required:[true,'Productpriceisrequired'],min:[0,'Pricecannotbenegative'],set:(v:number)=>Math.round(v*100)/100//Roundto2decimalplaces},product_quantity:{type:Number,required:[true,'Productquantityisrequired'],min:[0,'Quantitycannotbenegative'],default:0},product_type:{type:String,required:[true,'Producttypeisrequired'],enum:{values:['Electronics','Clothing','Furniture'],message:'ProducttypemustbeElectronics,Clothing,orFurniture'},index:true},shop_id:{type:Schema.Types.ObjectId,ref:'Shop',required:[true,'Productshopisrequired'],index:true},attributes_id:{type:Schema.Types.ObjectId,required:false,default:null},product_ratingsAverage:{type:Number,default:0,min:[0,'Ratingcannotbelessthan0'],max:[5,'Ratingcannotbemorethan5'],set:(value:number)=>Math.round(value*10)/10//Roundto1decimal},product_ratingsCount:{type:Number,default:0,min:[0,'Ratingscountcannotbenegative']},product_variations:[{name:{type:String,required:true,trim:true},options:[{type:String,required:true,trim:true}]}],product_slug:{type:String,unique:true,index:true},//StatusfieldsforbetterproductmanagementisDraft:{type:Boolean,default:true,index:true,select:false//Whenwequery(document.findOne)=>attribute'select'displaynoneifvalueis'false'},isPublished:{type:Boolean,default:false,index:true}},{collection:'Product',timestamps:true,toJSON:{virtuals:true},toObject:{virtuals:true}})productSchema.index({isPublished:1,isDraft:1})productSchema.index({product_name:'text',product_description:'text'},{weights:{product_name:10,product_description:5},name:'product_text_search'})exportconstfurnitureSchema=newSchema<IFurniture>({product_id:{type:Schema.Types.ObjectId,ref:'Product',required:true},brand:{type:String,required:true},material:{type:String,required:true},dimensions:{length:{type:Number,required:true},width:{type:Number,required:true},height:{type:Number,required:true},unit:{type:String,enum:['cm','inch'],default:'cm'},weight:{type:Number,required:true}}},{collection:'Furniture',timestamps:true})exportconstclothingSchema=newSchema<IClothing>({product_id:{type:Schema.Types.ObjectId,ref:'Product',required:true},brand:{type:String,required:true,trim:true},size:{type:[String],required:true},material:{type:String,required:true,trim:true},color:{type:[String],required:true,trim:true},style:{type:String,required:true,trim:true}},{collection:'Clothing',timestamps:true})exportconstelectronicSchema=newSchema<IElectronics>({product_id:{type:Schema.Types.ObjectId,ref:'Product',required:true},brand:{type:String,required:true,trim:true},model:{type:String,required:true,trim:true},warranty:{type:String,required:true,trim:true},specifications:{type:Map,of:String,//keyisStringrequired:true,trim:true,default:{}}},{collection:'Electronic',timestamps:true})``````API_Ecommerce\src\api\v1\models\order.model.tsimporttype{IOrder}from"~/api/v1/types/order.type";import{Schema}from"mongoose";exportconstorderSchema=newSchema<IOrder>({order_userId:{type:String,required:true},order_shipping:{type:Object,default:{}},order_payment:{type:Object,default:{}},order_products:{type:[],required:true},order_trackingNumber:{type:Number},order_status:{type:String,enum:['pending','confirm','shipped','cancelled'],default:'pending'},order_checkout:{type:Object,default:{}}},{timestamps:true})``````API_Ecommerce\src\api\v1\models\notification.model.tsimport{Schema,Types}from'mongoose'/***ORDER-001:Ordersuccessfully*ORDER-002:Orderfailed*PROMOTION-001:newPromotion*SHOP-001:newproductbyUserfollowing*/exportconstnotificationSchema=newSchema({noti_type:{type:String,enum:['ORDER-001','ORDER-002','PROMOTION-001','SHOP-001']},shop_id:{type:Types.ObjectId,ref:'shops'},user_id:{type:Types.ObjectId,ref:'users'},noti_content:{type:String,require:true},noti_options:{type:Object,default:{}}},{timestamps:true,collection:'Notification'})``````API_Ecommerce\src\api\v1\models\inventory.model.tsimport{Schema}from'mongoose'import{IInventory}from'~/api/v1/types/inventory.type'exportconstInventotySchema=newSchema<IInventory>({product_id:{type:Schema.Types.ObjectId,ref:'Product',required:true},shop_id:{type:Schema.Types.ObjectId,ref:'shops',required:true},inven_stock:{type:Number,required:[true,'Stockisrequired']},inven_reservations:{type:[String],default:[],validate:(reservations:string[])=>Array.isArray(reservations)}},{collection:'Inventory',timestamps:true})InventotySchema.index({product_id:1,shop_id:1},{unique:true})``````API_Ecommerce\src\api\v1\models\discount.model.tsimport{Schema}from'mongoose'import{IDiscount}from'~/api/v1/types/discount.type'exportconstdiscountSchema=newSchema<IDiscount>({shop_id:{type:Schema.Types.ObjectId,ref:'shops',required:true,index:true},discount_name:{type:String,required:[true,'discount_nameisrequired']},discount_description:{type:String,required:[true,'discount_descisrequired']},discount_type:{type:String,required:true,default:'fixed_amount'},discount_value:{type:Number,required:[true,'discount_valueisrequired']},discount_code:{type:String,required:[true,'discount_codeisrequired']},discount_start_date:{type:Date,required:[true,'discount_start_dateisrequired']},discount_end_date:{type:Date,required:[true,'discount_end_dateisrequired']},discount_max_uses:{type:Number,required:[true,'discount_max_usesisrequired']},discount_uses_count:{type:Number,required:[true,'discount_uses_countisrequired'],default:0},discount_users_used:{type:[String],default:[]},discount_max_uses_per_user:{type:Number,required:[true,'discount_max_uses_per_userisrequired']},discount_min_order_value:{type:Number,required:[true,'discount_min_order_valueisrequired']},discount_is_active:{type:Boolean,default:true},discount_applies_to:{type:String,required:true,enum:['all','specific']},discount_product_ids:{type:[String],default:[]}},{timestamps:true,collection:'Discounts'})``````API_Ecommerce\src\api\v1\models\comment.model.tsimport{Schema}from'mongoose'import{IComment}from'~/api/v1/types/comment.type'exportconstcommentSchema=newSchema<IComment>({comment_productId:{type:Schema.Types.ObjectId,ref:'Product'},comment_userId:{type:Schema.Types.ObjectId,ref:'users'},comment_content:{type:String,default:'text'},comment_left:{type:Number,default:0},comment_right:{type:Number,default:0},comment_parentId:{type:Schema.Types.ObjectId,ref:'Comment'},isDeleted:{type:Boolean,default:false},comment_level:{type:Number,default:0},comment_tree_id:{type:String}},{timestamps:true,collection:'Comments'})``````API_Ecommerce\src\api\v1\models\cart.model.tsimport{Schema}from'mongoose'import{ICartItem,ICartProducts,ICartVariant}from'~/api/v1/types/cart.type'constcartVariantSchema=newSchema<ICartVariant>({color:{type:String,required:true},size:{type:String,required:true},style:{type:String,required:false}},{_id:false})constcartProductsSchema=newSchema<ICartProducts>({product_id:{type:Schema.Types.ObjectId,ref:'Product',required:true},shop_id:{type:Schema.Types.ObjectId,ref:'shops',required:true},product_name:{type:String,trim:true,required:true},product_price:{type:Number,required:true,default:0},product_quantity:{type:Number,required:true,min:1,default:0},product_stock:{type:Number,required:true,min:0},product_variant:{type:cartVariantSchema,default:undefined}},{_id:false})exportconstcartSchema=newSchema<ICartItem>({user_id:{type:Schema.Types.ObjectId,ref:'users',require:true,unique:true},cart_state:{type:String,enum:['active','pending','failed'],default:'active',lowercase:true},cart_count_products:{type:Number,default:0},cart_total_item:{type:Number,default:0},cart_products:{type:[cartProductsSchema],default:[]}},{collection:'Cart',timestamps:true})``````API_Ecommerce\src\api\v1\models\address.model.tsimport{Schema}from'mongoose'import{IAddress}from'~/api/v1/types/address.type'exportconstaddressSchema=newSchema<IAddress>({type:{type:String,enum:['home','work'],default:'home'},fullName:{type:String,required:[true,'Tênngườinhậnlàbắtbuộc'],trim:true,maxlength:[100,'Tênkhôngđượcquá100kýtự']},phoneNumber:{type:String,required:[true,'Sốđiệnthoạilàbắtbuộc'],match:[/^[0-9+\-\s()]+$/,'Sốđiệnthoạikhônghợplệ']},addressLine1:{type:String,required:[true,'Địachỉlàbắtbuộc'],trim:true},addressLine2:{type:String,trim:true},city:{type:String,required:[true,'Thànhphốlàbắtbuộc'],trim:true},state:{type:String,required:[true,'Tỉnh/Thànhlàbắtbuộc'],trim:true},isDefault:{type:Boolean,default:false},country:{type:String,required:[true,'Quốcgialàbắtbuộc'],default:'Vietnam'}})```